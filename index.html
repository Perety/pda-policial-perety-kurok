<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sistema Policial</title>
<style>
:root{
  --bg-1:#06121a;
  --bg-2:#071729;
  --muted:#9fb3bd;
  --text:#e6f0f6;
  --accent:#7c3aed;
  --accent-2:#06b6a4;
  --danger:#ff6b6b;
  --glass:rgba(255,255,255,0.03);
  --card-grad:linear-gradient(180deg,rgba(255,255,255,0.014),rgba(255,255,255,0.006));
  --radius:12px;
  --shadow:0 14px 40px rgba(2,6,10,0.6);
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:radial-gradient(800px 300px at 12% 8%,rgba(124,58,237,0.06),transparent),linear-gradient(180deg,var(--bg-2) 0%,var(--bg-1) 60%);color:var(--text);-webkit-font-smoothing:antialiased}
.bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.nebula{position:absolute;width:60vmax;height:60vmax;left:-10vmin;top:-8vmin;background:radial-gradient(circle at 30% 30%,rgba(124,58,237,0.24),transparent 30%),radial-gradient(circle at 70% 70%,rgba(6,182,164,0.12),transparent 25%);filter:blur(56px) saturate(120%);animation:float 12s ease-in-out infinite}
.nebula.r{right:-10vmin;left:auto;top:6vmin;background:radial-gradient(circle at 70% 20%,rgba(255,80,120,0.20),transparent 30%),radial-gradient(circle at 30% 80%,rgba(110,231,183,0.12),transparent 25%);animation-duration:10s;animation-direction:reverse}
@keyframes float{0%,100%{transform:translateY(-8px)}50%{transform:translateY(8px)}}
.wrap{max-width:1200px;margin:22px auto;padding:20px;position:relative;z-index:2}
header{display:flex;align-items:center;justify-content:space-between;gap:18px;margin-bottom:20px;flex-wrap:wrap}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:900;color:#031018;font-size:28px}
h1{font-size:18px}
.subtitle{color:var(--muted);font-size:13px}
.top-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{background:var(--glass);padding:8px 12px;border-radius:999px;font-weight:700;color:var(--muted);font-size:13px}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#031018;padding:8px 16px;border-radius:10px;border:none;cursor:pointer;font-weight:800;transition:all .2s;font-size:13px}
.btn:hover{transform:translateY(-2px);opacity:0.9}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted);padding:7px 12px;border-radius:10px;cursor:pointer;transition:all .2s;font-weight:600;font-size:13px}
.btn-ghost:hover{border-color:var(--accent);color:var(--text)}
.btn-danger{background:linear-gradient(90deg,#ef4444,#dc2626);color:white}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:20px}
.card{background:var(--card-grad);border-radius:var(--radius);padding:20px;border:1px solid rgba(255,255,255,0.04);box-shadow:var(--shadow);min-height:140px;transition:all .18s;cursor:pointer;position:relative}
.card:hover{transform:translateY(-8px);box-shadow:0 30px 60px rgba(0,0,0,0.7);border-color:rgba(140,80,240,0.12)}
.card .icon{font-size:42px;margin-bottom:12px}
.card .title{font-weight:900;font-size:18px;margin-bottom:4px}
.card .desc{color:var(--muted);font-size:13px}
.card .badge{position:absolute;top:12px;right:12px;background:rgba(124,58,237,0.2);padding:4px 10px;border-radius:12px;font-size:11px;font-weight:800;color:var(--accent)}
.expanded{margin-top:20px;border-radius:12px;padding:24px;background:linear-gradient(180deg,rgba(255,255,255,0.012),rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.04);box-shadow:0 16px 44px rgba(0,0,0,0.55);animation:slideUp .3s ease}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.list{display:flex;flex-direction:column;gap:10px;max-height:500px;overflow-y:auto;padding-right:4px}
.list::-webkit-scrollbar{width:6px}
.list::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:10px}
.list::-webkit-scrollbar-thumb{background:rgba(124,58,237,0.3);border-radius:10px}
.item{padding:14px;border-radius:10px;background:rgba(255,255,255,0.012);border:1px solid rgba(255,255,255,0.03);transition:all .2s;display:flex;justify-content:space-between;align-items:center;gap:12px}
.item:hover{background:rgba(255,255,255,0.02);border-color:rgba(140,80,240,0.08)}
input,textarea,select{background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:8px;color:var(--text);font:inherit;transition:all .2s;width:100%}
input:focus,textarea:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,58,237,0.1)}
textarea{min-height:100px;resize:vertical}
label{display:block;margin-bottom:6px;font-size:13px;font-weight:600;color:var(--muted)}
.overlay{position:fixed;inset:0;background:rgba(2,6,10,0.92);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;z-index:9999}
.overlay.show{display:flex}
.modal{width:480px;max-width:95%;background:linear-gradient(180deg,#0a1628,#061421);padding:32px;border-radius:14px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 25px 70px rgba(0,0,0,0.9)}
.modal h3{font-size:24px;margin-bottom:8px}
.muted{color:var(--muted)}
.small{font-size:13px}
.mt-2{margin-top:8px}
.mt-3{margin-top:12px}
.flex{display:flex}
.flex-col{flex-direction:column}
.gap-2{gap:8px}
.grid-2{display:grid;grid-template-columns:2fr 1fr;gap:20px}
.sync-indicator{position:fixed;bottom:20px;right:20px;background:var(--glass);backdrop-filter:blur(10px);padding:10px 16px;border-radius:999px;border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:8px;z-index:1000}
.sync-dot{width:8px;height:8px;background:#4ade80;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
footer{margin-top:40px;text-align:center;color:var(--muted);font-size:12px;padding-bottom:20px}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
@keyframes slideOut{from{transform:translateX(0)}to{transform:translateX(100%)}}
</style>
</head>
<body>
<div class="bg"><div class="nebula"></div><div class="nebula r"></div></div>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">üõ°Ô∏è</div>
      <div>
        <h1> ùêíùê¢ùê¨ùê≠ùêûùê¶ùêö ùêèùêÉùêÄ ùêèùê®ùê•ùê¢ùêúùê¢ùêöùê• </h1>
        <div class="subtitle">¬© ·∂ú ≥·µâ·µÉ·µà·µí ·µñ·µí ≥ ·¥æ·µâ ≥·µâ·µó ∏</div>
      </div>
    </div>
    <div class="top-right">
      <div id="userDisplay" class="pill">Conectando...</div>
      <button id="btnLogin" class="btn-ghost">Entrar</button>
      <button id="btnLogout" class="btn-ghost" style="display:none">Salir</button>
      <div id="adminIndicator" style="display:none" class="pill">üëë Administrador</div>
    </div>
  </header>

  <div class="grid" id="cardsGrid"></div>
  <div id="expandedArea"></div>
  <footer> ¬© </footer>
</div>

<div class="sync-indicator">
  <div class="sync-dot"></div>
  <span class="small">Sincronizado</span>
</div>

<div id="loginModal" class="overlay">
  <div class="modal">
    <h3>Iniciar Sesi√≥n</h3>
    <div class="muted small">‚ö†Ô∏è Acceso solo para usuarios autorizados</div>
    <div style="margin-top:24px">
      <label>Usuario</label>
      <input id="loginUser" placeholder="Usuario">
      <label style="margin-top:12px">Contrase√±a</label>
      <input id="loginPass" type="password" placeholder="Contrase√±a">
      <div class="flex gap-2 mt-3">
        <button id="btnDoLogin" class="btn" style="flex:1">Entrar</button>
        <button id="btnCancelLogin" class="btn-ghost">Cancelar</button>
      </div>
      <div id="loginError" class="muted small mt-2" style="color:var(--danger);display:none"></div>
    </div>
    <div style="margin-top:24px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.05)">
      <div class="muted small">‚ö†Ô∏è Solo usuarios autorizados. Contacte al administrador para obtener acceso.</div>
    </div>
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

const SUPABASE_URL = 'https://lqwyoobsvfbetqqjjdkt.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxxd3lvb2JzdmZiZXRxcWpqZGt0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTczMTIsImV4cCI6MjA3ODk3MzMxMn0.F80qOvvwWnj_HquIM4B3LDBSDVU3_9zmKUVaCfAwXcc';

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

/* STATE & HELPERS */
const STATE = {
  currentUser:null,
  loading:false,
  loadingAll:false,
  data:{usuarios:[],ciudadanos:[],multas:[],arrestos:[],vehiculos:[],denuncias:[],investigaciones:[],llamadas:[],bolo:[],alertas:[],auditoria:[],servicio:[]},
  servicioActual:null
};

const $ = (s,r=document)=> r.querySelector(s);
const $$ = (s,r=document)=> Array.from(r.querySelectorAll(s));
const html = s => (s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

/* Password hash helper (SHA-256) */
async function hashPassword(pass){
  const encoder = new TextEncoder();
  const data = encoder.encode(pass + 'POLICE_SECURE_SALT_2024_X9Z');
  const hash = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* Generic DB helpers */
async function loadData(table){
  try{
    const { data, error } = await supabase.from(table).select('*').order('id',{ascending:false});
    if(error) throw error;
    return data || [];
  }catch(e){
    console.error(`Error cargando ${table}:`, e);
    return [];
  }
}

async function saveData(table, item){
  STATE.loading = true;
  try{
    const { error } = await supabase.from(table).insert([item]);
    if(error) throw error;
    showNotif('‚úì Guardado correctamente','success');
    await loadAllData(); // refresh all after save
    return true;
  }catch(e){
    console.error('Error guardando:', e);
    showNotif('‚úó Error: '+(e.message||e),'error');
    return false;
  }finally{
    STATE.loading = false;
  }
}

async function deleteData(table, id){
  STATE.loading = true;
  try{
    const { error } = await supabase.from(table).delete().eq('id', id);
    if(error) throw error;
    showNotif('‚úì Eliminado','success');
    await loadAllData();
    return true;
  }catch(e){
    console.error('Error eliminando:', e);
    showNotif('‚úó Error al eliminar','error');
    return false;
  }finally{
    STATE.loading = false;
  }
}

async function registrarAuditoria(accion){
  try{
    await supabase.from('auditoria').insert([{ accion, usuario: STATE.currentUser?.nombre || 'Sistema', fecha: new Date().toISOString() }]);
  }catch(e){
    console.error('Error auditor√≠a:', e);
  }
}

/* Full data loader with simple concurrency guard */
async function loadAllData(){
  if(STATE.loadingAll){
    // minor wait to avoid overlapping full loads
    let waited = 0;
    while(STATE.loadingAll && waited < 3000){
      await new Promise(r=>setTimeout(r,50));
      waited += 50;
    }
    if(STATE.loadingAll) console.warn('loadAllData: previous full load still running; proceeding anyway.');
  }
  STATE.loadingAll = true;
  STATE.loading = true;
  try{
    const tables = ['usuarios','ciudadanos','multas','arrestos','vehiculos','denuncias','investigaciones','llamadas','bolo','alertas','auditoria','servicio'];
    const results = await Promise.all(tables.map(t => loadData(t)));
    STATE.data = {
      usuarios: results[0]||[],
      ciudadanos: results[1]||[],
      multas: results[2]||[],
      arrestos: results[3]||[],
      vehiculos: results[4]||[],
      denuncias: results[5]||[],
      investigaciones: results[6]||[],
      llamadas: results[7]||[],
      bolo: results[8]||[],
      alertas: results[9]||[],
      auditoria: results[10]||[],
      servicio: results[11]||[]
    };
    updateCardBadges();
  }catch(e){
    console.error('Error cargando datos:', e);
  }finally{
    STATE.loading = false;
    STATE.loadingAll = false;
  }
}

/* Notifications (visual) */
function showNotif(m, t='info'){
  const n = document.createElement('div');
  n.style.cssText = `position:fixed;top:80px;right:20px;z-index:10000;padding:14px 24px;border-radius:10px;background:${t==='success'?'linear-gradient(90deg,#10b981,#059669)':'linear-gradient(90deg,#ef4444,#dc2626)'};color:white;font-weight:700;box-shadow:0 10px 40px rgba(0,0,0,0.6);animation:slideIn 0.3s ease`;
  n.textContent = m;
  document.body.appendChild(n);
  setTimeout(()=>{ n.style.animation='slideOut 0.3s ease'; setTimeout(()=>n.remove(),300) }, 3000);
}

/* Update numeric badges on cards */
function updateCardBadges(){
  const b = {
    ciudadanos: STATE.data.ciudadanos.length,
    multas: STATE.data.multas.length,
    arrestos: STATE.data.arrestos.length,
    vehiculos: STATE.data.vehiculos.length,
    denuncias: STATE.data.denuncias.length,
    investigaciones: STATE.data.investigaciones.length,
    llamadas: STATE.data.llamadas.length,
    bolo: STATE.data.bolo.length,
    alertas: STATE.data.alertas.length,
    auditoria: STATE.data.auditoria.length
  };
  Object.keys(b).forEach(id=>{
    const c = document.querySelector(`[data-card="${id}"]`);
    if(c && b[id] > 0){
      let badge = c.querySelector('.badge');
      if(!badge){ badge = document.createElement('div'); badge.className='badge'; c.appendChild(badge); }
      badge.textContent = b[id];
    } else if(c){
      const badge = c.querySelector('.badge');
      if(badge) badge.remove();
    }
  });
}

/* Init admin user if table empty */
async function initAdmin(){
  try{
    const users = await loadData('usuarios');
    if(users.length === 0){
      const hashedPass = await hashPassword('PoliceSecure2024!');
      await supabase.from('usuarios').insert([{ username:'admin', password:hashedPass, nombre:'Administrador del Sistema', rol:'admin', placa:'ADMIN-001', fechacreacion:new Date().toISOString() }]);
      console.log('‚úì Usuario admin creado (admin / PoliceSecure2024!)');
    }
  }catch(e){
    console.error('Error inicializando admin:', e);
  }
}

/* End of Part 1/5 */
</script>
<body>

<div id="app">

    <!-- NAV SUPERIOR -->
    <nav class="nav">
        <div class="left">
            <strong>Sistema Policial</strong>
        </div>
        <div class="right" id="userInfo">
            <span id="userName" class="muted">No conectado</span>
        </div>
    </nav>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container">

        <!-- GRID DE CARDS -->
        <div class="cards" id="cardsContainer">
            <!-- Las cards se generan din√°micamente desde JS -->
        </div>

        <!-- PANEL PRINCIPAL -->
        <div class="panel" id="mainPanel">
            <div id="panelContent" class="panel-content">
                <div class="muted">Selecciona una funci√≥n del panel izquierdo.</div>
            </div>
        </div>

    </div>

</div>

<!-- TOAST DE NOTIFICACIONES -->
<div id="toast" class="toast"></div>
<script>
// ======================================================
// CONFIGURACI√ìN INICIAL
// ======================================================

const STATE = {
    currentUser: null,
    servicioActual: null
};

const CARDS = [
    { id: 'servicio', title: 'En servicio', desc: 'Usuarios activos', icon: 'üü¢' },
    { id: 'llamadas', title: 'Llamadas', desc: 'Gesti√≥n de avisos', icon: 'üìû' },
    { id: 'codigos', title: 'C√≥digos', desc: 'C√≥digos policiales', icon: 'üì°' }
];


// ======================================================
// RENDERIZAR CARDS
// ======================================================
function renderCards() {
    const container = document.getElementById("cardsContainer");
    container.innerHTML = CARDS.map(c => `
        <div class="card" onclick="openPanel('${c.id}')">
            <div class="icon">${c.icon}</div>
            <div class="title">${c.title}</div>
            <div class="desc">${c.desc}</div>
        </div>
    `).join('');
}

renderCards();


// ======================================================
// CAMBIAR PANEL
// ======================================================
function openPanel(id) {
    const p = document.getElementById("panelContent");

    if (id === 'servicio') return renderServicio(p);
    if (id === 'codigos') return renderCodigos(p);
    if (id === 'llamadas') return renderLlamadas(p);

    p.innerHTML = `<div class="muted small">Panel no encontrado</div>`;
}


// ======================================================
// PANEL ‚Äî EN SERVICIO
// ======================================================
function renderServicio(p) {
    const enServicio = STATE.servicioActual && !STATE.servicioActual.fecha_salida;

    p.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <strong style="font-size:20px">üü¢ Usuarios en servicio</strong>
            <button class="btn ${enServicio ? 'btn-danger' : ''}" id="btnTglServ">
                ${enServicio ? 'Salir de servicio' : 'Entrar en servicio'}
            </button>
        </div>

        <div id="usuariosEnServicio" class="list small"></div>
    `;

    document.getElementById('btnTglServ').onclick = async () => {
        if (!STATE.currentUser) return showNotif('Debes iniciar sesi√≥n', 'error');

        if (!enServicio) {
            // ENTRAR
            await supabase.from('servicio').insert([{
                usuario_id: STATE.currentUser.id,
                username: STATE.currentUser.username,
                nombre: STATE.currentUser.nombre || STATE.currentUser.username
            }]);
        } else {
            // SALIR
            await supabase.from('servicio')
                .update({
                    fecha_salida: new Date().toISOString(),
                    en_servicio: false
                })
                .eq('id', STATE.servicioActual.id);
        }

        await loadServicio();
        renderServicio(p);
    };

    loadServicioLista();
}


// ======================================================
// SUPABASE ‚Äî CARGAR SERVICIO DEL USUARIO
// ======================================================
async function loadServicio() {
    if (!STATE.currentUser) return;
    
    const { data } = await supabase
        .from('servicio')
        .select('*')
        .eq('usuario_id', STATE.currentUser.id)
        .is('fecha_salida', null)
        .order('fecha_entrada', { ascending: false });

    STATE.servicioActual = data?.[0] || null;
}


// ======================================================
// SUPABASE ‚Äî LISTA DE TODOS LOS EN SERVICIO
// ======================================================
async function loadServicioLista() {
    const list = document.getElementById('usuariosEnServicio');
    if (!list) return;

    const { data, error } = await supabase
        .from('servicio')
        .select('username, nombre, fecha_entrada')
        .is('fecha_salida', null)
        .order('fecha_entrada', { ascending: true });

    if (error) {
        list.innerHTML = `<div class="muted small">Error cargando lista</div>`;
        return;
    }

    list.innerHTML = data?.length
        ? data.map(u => `
            <div class="item">
                <strong>${u.nombre || u.username}</strong>
                <span class="muted small">${new Date(u.fecha_entrada).toLocaleTimeString()}</span>
            </div>
        `).join('')
        : `<div class="muted small">Nadie en servicio</div>`;
}
<script>
// ======================================================
// PANEL ‚Äî C√ìDIGOS POLICIALES
// ======================================================
function renderCodigos(p) {
    const codigos = [
        { code: '10-4', desc: 'Mensaje recibido' },
        { code: '10-6', desc: 'Ocupado' },
        { code: '10-8', desc: 'En servicio' },
        { code: '10-15', desc: 'Detenido' },
        { code: '10-20', desc: 'Ubicaci√≥n' },
        { code: '10-23', desc: 'En el sitio' },
        { code: '10-31', desc: 'Crimen en progreso' },
        { code: '10-99', desc: 'Situaci√≥n peligrosa' }
    ];

    p.innerHTML = `
        <div>
            <strong style="font-size:20px">üì° C√≥digos Policiales</strong>
            <div id="codigosList" class="list" style="margin-top:14px">
                ${codigos.map(c => `
                    <div class="item" style="cursor:pointer" data-code="${c.code}">
                        <strong><span class="badge">${c.code}</span> ${c.desc}</strong>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    // Eventos de clic para cada c√≥digo
    document.querySelectorAll('#codigosList .item').forEach(item => {
        item.onclick = async () => {
            if (!STATE.currentUser)
                return showNotif('Debes iniciar sesi√≥n primero', 'error');

            const code = item.getAttribute("data-code");
            const nombre = STATE.currentUser.nombre || STATE.currentUser.username;

            // Guardar auditor√≠a en Supabase
            await supabase.from('auditoria').insert([{
                accion: `C√≥digo emitido: ${code}`,
                usuario: nombre,
                fecha: new Date().toISOString()
            }]);

            // Notificaci√≥n visible
            showNotif(`üõ°Ô∏è <b>${nombre}</b> envi√≥ el c√≥digo <b>${code}</b>`, 'info');

            // Si usas Realtime, aqu√≠ se recibe en otros clientes autom√°ticamente
        };
    });
}


// ======================================================
// PANEL ‚Äî LLAMADAS (Versi√≥n b√°sica, mejorada)
// ======================================================
function renderLlamadas(p) {
    p.innerHTML = `
        <strong style="font-size:20px">üìû Llamadas</strong>
        <div class="muted small" style="margin-top:6px">
            Sistema b√°sico de llamadas en desarrollo.
        </div>
        <button class="btn" style="margin-top:14px" onclick="nuevaLlamada()">
            Registrar llamada
        </button>

        <div id="listaLlamadas" class="list" style="margin-top:16px"></div>
    `;

    loadLlamadas();
}

// Registrar llamada simple
async function nuevaLlamada() {
    if (!STATE.currentUser) return showNotif("Debes iniciar sesi√≥n", "error");

    const text = prompt("Describe la llamada:");
    if (!text) return;

    await supabase.from('llamadas').insert([{
        descripcion: text,
        usuario: STATE.currentUser.nombre || STATE.currentUser.username,
        fecha: new Date().toISOString()
    }]);

    showNotif("üìû Llamada registrada", "success");
    loadLlamadas();
}

// Lista de llamadas
async function loadLlamadas() {
    const cont = document.getElementById('listaLlamadas');
    if (!cont) return;

    const { data } = await supabase
        .from('llamadas')
        .select('*')
        .order('fecha', { ascending: false });

    if (!data?.length) {
        cont.innerHTML = `<div class="muted small">No hay llamadas</div>`;
        return;
    }

    cont.innerHTML = data.map(l => `
        <div class="item">
            <strong>${l.usuario}</strong>
            <div class="small">${l.descripcion}</div>
            <div class="muted small">${new Date(l.fecha).toLocaleString()}</div>
        </div>
    `).join('');
}


// ======================================================
// SISTEMA DE NOTIFICACIONES
// ======================================================
function showNotif(msg, type = "info") {
    const t = document.getElementById("toast");

    t.className = "toast show " + type;
    t.innerHTML = msg;

    setTimeout(() => {
        t.className = "toast";
    }, 2500);
}
</script>
<script>
// ======================================================
// LOGIN SUPER B√ÅSICO (adaptable a tu sistema real)
// ======================================================
async function fakeLogin() {
    const nombre = prompt("Nombre de usuario:");
    if (!nombre) return;

    STATE.currentUser = {
        id: Date.now(),       // si tienes auth real, sustit√∫yelo
        username: nombre.toLowerCase(),
        nombre
    };

    document.getElementById("userName").innerText = nombre;

    await loadServicio();
    showNotif("Sesi√≥n iniciada", "success");
}


// Bot√≥n de login simulado
document.getElementById("userInfo").onclick = () => fakeLogin();


// ======================================================
// SUPABASE ‚Äî CLIENTE
// ======================================================
const supabase = window.supabase.createClient(
    "https://TU-PROJECT.supabase.co",
    "TU-API-KEY-PUBLICA"
);
</script>

</body>

<style>
/* ============================
   ESTILOS GENERALES
   ============================ */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #151515;
    color: white;
}

.nav {
    padding: 14px 20px;
    background: #202020;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.container {
    display: flex;
    padding: 20px;
    gap: 20px;
}

.cards {
    width: 260px;
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.card {
    background: #1f1f1f;
    padding: 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.15s;
    border: 1px solid #2a2a2a;
}

.card:hover {
    background: #2b2b2b;
}

.card .icon {
    font-size: 26px;
}

.card .title {
    font-size: 18px;
    margin-top: 6px;
}

.card .desc {
    color: #999;
    font-size: 14px;
}

/* PANEL */
.panel {
    flex: 1;
    background: #1e1e1e;
    border-radius: 10px;
    border: 1px solid #2c2c2c;
    padding: 20px;
}

.list .item {
    padding: 12px 10px;
    border-bottom: 1px solid #333;
}

.badge {
    display: inline-block;
    padding: 2px 7px;
    background: #444;
    border-radius: 6px;
    margin-right: 6px;
}

/* BOTONES */
.btn {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    background: #008cff;
    color: white;
    cursor: pointer;
    font-size: 14px;
}

.btn-danger {
    background: #d43535;
}

/* NOTIFICACIONES */
.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    padding: 14px 18px;
    border-radius: 6px;
    opacity: 0;
    transition: 0.25s;
    pointer-events: none;
}

.toast.show {
    opacity: 1;
}

.toast.info {
    background: #0066ff;
}

.toast.success {
    background: #00a347;
}

.toast.error {
    background: #c62828;
}
</style>

</html>
